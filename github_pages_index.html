<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bridge Family Therapy - Evaluation Reports Portal</title>
    <style>
        /* Base Typography - Consistent with BFT branding */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #f0f4f8 100%);
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #367AA6 0%, #2c5f8d 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #367AA6;
            font-size: 20px;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 300;
            letter-spacing: -0.5px;
        }

        .tagline {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
            font-style: italic;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 20px;
        }

        /* Dashboard Cards */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #367AA6;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #367AA6;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Search and Filter Section */
        .controls {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .controls-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #367AA6;
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .filter-select {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: border-color 0.3s;
            background: white;
        }

        .filter-select:focus {
            outline: none;
            border-color: #367AA6;
        }

        .btn {
            padding: 10px 20px;
            background: #367AA6;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #2c5f8d;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* Reports Table */
        .reports-section {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .section-header {
            background: #f8f9fa;
            padding: 1.5rem;
            border-bottom: 2px solid #e8f0f7;
        }

        .section-title {
            font-size: 1.3rem;
            color: #367AA6;
            margin-bottom: 0.5rem;
        }

        .section-subtitle {
            color: #666;
            font-size: 0.9rem;
        }

        .reports-table {
            width: 100%;
            border-collapse: collapse;
        }

        .reports-table thead {
            background: #e8f0f7;
        }

        .reports-table th {
            padding: 1rem;
            text-align: left;
            color: #367AA6;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #d1e3f0;
        }

        .reports-table tbody tr {
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
        }

        .reports-table tbody tr:hover {
            background: #f8fbfd;
        }

        .reports-table td {
            padding: 1rem;
            color: #333;
        }

        .client-id {
            font-weight: 600;
            color: #367AA6;
        }

        .battery-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .badge-neurodiversity {
            background: #e3f2fd;
            color: #1976d2;
        }

        .badge-trauma {
            background: #fce4ec;
            color: #c2185b;
        }

        .badge-comprehensive {
            background: #e8f5e9;
            color: #388e3c;
        }

        .view-link {
            color: #367AA6;
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: color 0.2s;
        }

        .view-link:hover {
            color: #2c5f8d;
            text-decoration: underline;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-complete {
            background: #4caf50;
        }

        .status-partial {
            background: #ff9800;
        }

        .status-processing {
            background: #2196f3;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }

        .empty-icon {
            font-size: 3rem;
            color: #ccc;
            margin-bottom: 1rem;
        }

        /* Upload Section */
        .upload-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 2px dashed #e0e0e0;
            text-align: center;
        }

        .upload-icon {
            font-size: 2.5rem;
            color: #367AA6;
            margin-bottom: 1rem;
        }

        .upload-text {
            color: #666;
            margin-bottom: 1rem;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            color: #666;
            font-size: 0.9rem;
            margin-top: 4rem;
            border-top: 1px solid #e0e0e0;
        }

        .footer a {
            color: #367AA6;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                text-align: center;
            }

            .logo-section {
                width: 100%;
                justify-content: center;
                margin-bottom: 1rem;
            }

            .reports-table {
                font-size: 0.9rem;
            }

            .reports-table th,
            .reports-table td {
                padding: 0.75rem 0.5rem;
            }

            .battery-badge {
                font-size: 0.75rem;
                padding: 2px 8px;
            }

            .hide-mobile {
                display: none;
            }
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #367AA6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: none;
            animation: slideIn 0.3s ease-out;
            z-index: 1000;
        }

        .toast.success {
            background: #4caf50;
        }

        .toast.error {
            background: #f44336;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">BFT</div>
                <div>
                    <h1>Evaluation Reports Portal</h1>
                    <div class="tagline">Where Connection Meets Healing</div>
                </div>
            </div>
            <div>
                <span style="opacity: 0.8; font-size: 0.9rem;">Bridge Family Therapy</span>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Dashboard Stats -->
        <div class="dashboard">
            <div class="stat-card">
                <div class="stat-number" id="total-reports">0</div>
                <div class="stat-label">Total Reports</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="recent-reports">0</div>
                <div class="stat-label">This Month</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="active-clients">0</div>
                <div class="stat-label">Active Clients</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="battery-types">3</div>
                <div class="stat-label">Battery Types</div>
            </div>
        </div>

        <!-- Search and Filter Controls -->
        <div class="controls">
            <div class="controls-row">
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="Search by client ID or date...">
                    <span class="search-icon">🔍</span>
                </div>
                <select class="filter-select" id="battery-filter">
                    <option value="">All Batteries</option>
                    <option value="neurodiversity">Neurodiversity Screener</option>
                    <option value="trauma">Trauma Battery</option>
                    <option value="comprehensive">Comprehensive Assessment</option>
                </select>
                <select class="filter-select" id="sort-select">
                    <option value="date-desc">Newest First</option>
                    <option value="date-asc">Oldest First</option>
                    <option value="client">Client ID</option>
                </select>
                <button class="btn btn-secondary" onclick="refreshReports()">↻ Refresh</button>
            </div>
        </div>

        <!-- Reports Table -->
        <div class="reports-section">
            <div class="section-header">
                <h2 class="section-title">Assessment Reports</h2>
                <div class="section-subtitle">Click on any report to view in a new tab</div>
            </div>
            
            <table class="reports-table">
                <thead>
                    <tr>
                        <th>Status</th>
                        <th>Client ID</th>
                        <th>Date</th>
                        <th>Battery Type</th>
                        <th class="hide-mobile">Assessments</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="reports-tbody">
                    <!-- Reports will be populated here by JavaScript -->
                </tbody>
            </table>

            <!-- Empty State -->
            <div id="empty-state" class="empty-state" style="display: none;">
                <div class="empty-icon">📊</div>
                <h3>No Reports Found</h3>
                <p>Upload your first evaluation report to get started</p>
            </div>
        </div>

        <!-- Upload Instructions -->
        <div class="upload-section">
            <div class="upload-icon">📁</div>
            <h3>How to Add Reports</h3>
            <p class="upload-text">
                To add new evaluation reports to this portal:
            </p>
            <ol style="text-align: left; max-width: 600px; margin: 0 auto;">
                <li>Generate your report using the Catalyst Evaluator system</li>
                <li>Upload the HTML file to this GitHub repository</li>
                <li>The report will automatically appear in the list above</li>
                <li>Use descriptive filenames like: <code>ClientID_YYYY_MM_DD_BatteryType.html</code></li>
            </ol>
            <button class="btn" onclick="window.open('https://github.com/your-username/your-repo', '_blank')" style="margin-top: 1rem;">
                Open Repository
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>© 2025 Bridge Family Therapy | Powered by Catalyst Evaluator v1.8</p>
        <p>
            <a href="https://bridgefamilytherapy.com" target="_blank">Main Website</a> | 
            <a href="#" onclick="showAbout()">About This Portal</a> | 
            <a href="#" onclick="showPrivacy()">Privacy</a>
        </p>
    </footer>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- JavaScript -->
    <script>
        // Sample data structure - In production, this would be fetched from GitHub API
        // or generated from actual files in the repository
        let reportsData = [
            {
                id: 'BS_2025_09_18_1313',
                clientId: 'BS',
                date: '2025-09-18',
                time: '13:13',
                battery: 'neurodiversity',
                batteryName: 'Neurodiversity Screener',
                assessments: ['ASRS', 'CATI', 'DASS-21', 'ITQ', 'MAIA-2', 'MSS', 'OCI-R', 'TAS'],
                status: 'complete',
                filename: 'BS_2025_09_18_1313_Neurodiversity_Screener.html'
            },
            {
                id: 'NTS_2025_09_15_1709',
                clientId: 'NTS',
                date: '2025-09-15',
                time: '17:09',
                battery: 'neurodiversity',
                batteryName: 'Neurodiversity Screener',
                assessments: ['ASRS', 'CATI', 'DASS-21', 'ITQ', 'MAIA-2', 'MSS', 'OCI-R', 'TAS'],
                status: 'complete',
                filename: 'NTS_2025_09_15_1709_Neurodiversity_Screener.html'
            }
            // More reports would be added here automatically
        ];

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadReports();
            updateStats();
            setupEventListeners();
        });

        // Load and display reports
        function loadReports(filter = '') {
            const tbody = document.getElementById('reports-tbody');
            const emptyState = document.getElementById('empty-state');
            
            // Filter reports based on search and filters
            let filteredReports = filterReports(reportsData, filter);
            
            // Sort reports
            filteredReports = sortReports(filteredReports);
            
            if (filteredReports.length === 0) {
                tbody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            tbody.innerHTML = filteredReports.map(report => createReportRow(report)).join('');
        }

        // Create a table row for a report
        function createReportRow(report) {
            const statusClass = `status-${report.status}`;
            const badgeClass = `badge-${report.battery}`;
            const assessmentList = report.assessments.join(', ');
            
            return `
                <tr>
                    <td><span class="status-indicator ${statusClass}"></span></td>
                    <td><span class="client-id">${report.clientId}_${report.date.replace(/-/g, '_')}_${report.time.replace(/:/g, '')}</span></td>
                    <td>${formatDate(report.date)}</td>
                    <td><span class="battery-badge ${badgeClass}">${report.batteryName}</span></td>
                    <td class="hide-mobile" style="font-size: 0.85rem; color: #666;">${assessmentList}</td>
                    <td>
                        <a href="${report.filename}" target="_blank" class="view-link">
                            View Report →
                        </a>
                    </td>
                </tr>
            `;
        }

        // Filter reports based on search and filter criteria
        function filterReports(reports, searchTerm = '') {
            const batteryFilter = document.getElementById('battery-filter').value;
            const searchInput = document.getElementById('search-input').value.toLowerCase();
            
            return reports.filter(report => {
                const matchesBattery = !batteryFilter || report.battery === batteryFilter;
                const matchesSearch = !searchInput || 
                    report.clientId.toLowerCase().includes(searchInput) ||
                    report.date.includes(searchInput) ||
                    report.id.toLowerCase().includes(searchInput);
                
                return matchesBattery && matchesSearch;
            });
        }

        // Sort reports
        function sortReports(reports) {
            const sortBy = document.getElementById('sort-select').value;
            
            return [...reports].sort((a, b) => {
                switch(sortBy) {
                    case 'date-asc':
                        return new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time);
                    case 'date-desc':
                        return new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time);
                    case 'client':
                        return a.clientId.localeCompare(b.clientId);
                    default:
                        return 0;
                }
            });
        }

        // Update dashboard statistics
        function updateStats() {
            document.getElementById('total-reports').textContent = reportsData.length;
            
            // Calculate reports this month
            const now = new Date();
            const thisMonth = reportsData.filter(report => {
                const reportDate = new Date(report.date);
                return reportDate.getMonth() === now.getMonth() && 
                       reportDate.getFullYear() === now.getFullYear();
            }).length;
            document.getElementById('recent-reports').textContent = thisMonth;
            
            // Count unique clients
            const uniqueClients = new Set(reportsData.map(r => r.clientId)).size;
            document.getElementById('active-clients').textContent = uniqueClients;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search input
            document.getElementById('search-input').addEventListener('input', () => {
                loadReports();
            });
            
            // Battery filter
            document.getElementById('battery-filter').addEventListener('change', () => {
                loadReports();
            });
            
            // Sort select
            document.getElementById('sort-select').addEventListener('change', () => {
                loadReports();
            });
        }

        // Refresh reports (in production, this would fetch from GitHub)
        function refreshReports() {
            showToast('Refreshing reports...', 'success');
            // Simulate refresh
            setTimeout(() => {
                loadReports();
                updateStats();
                showToast('Reports refreshed!', 'success');
            }, 1000);
        }

        // Format date for display
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // Show about dialog
        function showAbout() {
            alert('Catalyst Evaluator Portal v1.8\n\nThis portal provides secure access to psychological evaluation reports generated by the Catalyst Evaluator system.\n\nFor support, contact Bridge Family Therapy.');
        }

        // Show privacy dialog
        function showPrivacy() {
            alert('Privacy Notice\n\nAll evaluation reports are stored securely and accessed only through authenticated channels. Client data is anonymized using initials and timestamps.\n\nNo personal health information is transmitted or stored by this portal interface.');
        }

        // In production, this function would fetch the actual list of HTML files
        // from the GitHub repository using the GitHub API
        async function fetchReportsFromGitHub() {
            // Example implementation:
            /*
            const response = await fetch('https://api.github.com/repos/username/repo/contents/reports');
            const files = await response.json();
            
            reportsData = files
                .filter(file => file.name.endsWith('.html'))
                .map(file => parseFilename(file.name));
            
            loadReports();
            updateStats();
            */
        }

        // Parse filename to extract report metadata
        function parseFilename(filename) {
            // Expected format: ClientID_YYYY_MM_DD_HHMM_BatteryType.html
            const parts = filename.replace('.html', '').split('_');
            return {
                id: parts.slice(0, 5).join('_'),
                clientId: parts[0],
                date: `${parts[1]}-${parts[2]}-${parts[3]}`,
                time: `${parts[4].slice(0, 2)}:${parts[4].slice(2)}`,
                battery: detectBatteryType(filename),
                batteryName: getBatteryName(filename),
                assessments: detectAssessments(filename),
                status: 'complete',
                filename: filename
            };
        }

        // Detect battery type from filename
        function detectBatteryType(filename) {
            if (filename.includes('Neurodiversity')) return 'neurodiversity';
            if (filename.includes('Trauma')) return 'trauma';
            if (filename.includes('Comprehensive')) return 'comprehensive';
            return 'unknown';
        }

        // Get battery display name
        function getBatteryName(filename) {
            if (filename.includes('Neurodiversity')) return 'Neurodiversity Screener';
            if (filename.includes('Trauma')) return 'Trauma Battery';
            if (filename.includes('Comprehensive')) return 'Comprehensive Assessment';
            return 'Unknown Battery';
        }

        // Detect assessments (would be more sophisticated in production)
        function detectAssessments(filename) {
            // Default assessments based on battery type
            if (filename.includes('Neurodiversity')) {
                return ['ASRS', 'CATI', 'DASS-21', 'ITQ', 'MAIA-2', 'MSS', 'OCI-R', 'TAS'];
            }
            return [];
        }
    </script>
</body>
</html>